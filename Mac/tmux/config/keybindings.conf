# ~/.config/tmux/config/keybindings.conf
# Tmux 快捷键绑定配置

###############################################################################
# 前缀键设置
###############################################################################

# 取消默认前缀键
unbind C-b

# 设置新的前缀键为 Ctrl-a
set -g prefix C-a

# 绑定 C-a C-a 发送真正的 C-a
bind C-a send-prefix

###############################################################################
# 重载配置
###############################################################################

# 重载tmux配置文件
bind r source-file ~/.config/tmux/tmux.conf \; display "配置已重载!"

###############################################################################
# 会话管理
###############################################################################

# 快速切换到上一个会话
bind -r Tab switch-client -l

# 新建会话
bind N new-session

# 重命名会话
bind R command-prompt -I "#{session_name}" "rename-session '%%'"

###############################################################################
# 窗口管理
###############################################################################

# 新建窗口 (保持当前路径)
bind c new-window -c "#{pane_current_path}"

# 关闭窗口
bind X confirm-before -p "关闭窗口 #W? (y/n)" kill-window

# 重命名窗口
bind , command-prompt -I "#{window_name}" "rename-window '%%'"

# 窗口导航
bind -r C-h previous-window
bind -r C-l next-window

# 快速选择窗口
bind -r Tab last-window

# 窗口重排序
bind -r H swap-window -t -1\; select-window -t -1
bind -r L swap-window -t +1\; select-window -t +1

###############################################################################
# 面板管理
###############################################################################

# 面板分割 (保持当前路径)
bind '\' split-window -h -c "#{pane_current_path}"  # 垂直分割
bind - split-window -v -c "#{pane_current_path}"    # 水平分割

# 面板导航 (vim风格)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# 面板调整大小
bind -r M-h resize-pane -L 5
bind -r M-j resize-pane -D 5
bind -r M-k resize-pane -U 5
bind -r M-l resize-pane -R 5

# 更精细的面板调整
bind -r C-M-h resize-pane -L 1
bind -r C-M-j resize-pane -D 1
bind -r C-M-k resize-pane -U 1
bind -r C-M-l resize-pane -R 1

# 面板交换
bind > swap-pane -D
bind < swap-pane -U

# 关闭面板
bind x confirm-before -p "关闭面板? (y/n)" kill-pane

# 面板最大化/还原
bind m resize-pane -Z

# 面板同步输入切换
bind S set-option synchronize-panes\; display "面板同步: #{?synchronize-panes,开启,关闭}"

###############################################################################
# 复制模式
###############################################################################

# 进入复制模式
bind v copy-mode

# 粘贴
bind p paste-buffer

# 选择并复制到系统剪贴板
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"
bind -T copy-mode-vi Escape send-keys -X cancel

# 鼠标选择复制
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "pbcopy"

###############################################################################
# 鼠标设置
###############################################################################

# 鼠标点击选择面板
bind -n MouseDown1Pane select-pane -t =

# 双击选择单词
bind -n DoubleClick1Pane select-pane \; copy-mode -M \; send-keys -X select-word

# 三击选择行
bind -n TripleClick1Pane select-pane \; copy-mode -M \; send-keys -X select-line

###############################################################################
# 快速跳转
###############################################################################

# 快速跳转到指定窗口
bind 0 select-window -t :0
bind 1 select-window -t :1
bind 2 select-window -t :2
bind 3 select-window -t :3
bind 4 select-window -t :4
bind 5 select-window -t :5
bind 6 select-window -t :6
bind 7 select-window -t :7
bind 8 select-window -t :8
bind 9 select-window -t :9

###############################################################################
# 插件相关快捷键
###############################################################################

# tmux-resurrect 快捷键
bind C-s run-shell "~/.config/tmux/plugins/tmux-resurrect/scripts/save.sh"
bind C-r run-shell "~/.config/tmux/plugins/tmux-resurrect/scripts/restore.sh"

###############################################################################
# 实用功能
###############################################################################

# 清屏
bind C-l send-keys 'clear' Enter

# 显示时钟
bind t clock-mode

# 选择面板编号
bind q display-panes

# 列出所有粘贴缓冲区
bind b list-buffers

# 选择粘贴缓冲区
bind B choose-buffer

# 删除最新的粘贴缓冲区
bind Delete delete-buffer

###############################################################################
# 临时取消所有快捷键 (紧急情况下使用)
###############################################################################

# 取消所有键绑定 (谨慎使用)
bind C-q confirm-before -p "取消所有键绑定? (y/n)" "unbind-key -a"
